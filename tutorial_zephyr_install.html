<!DOCTYPE html>
<html class="writer-html5" lang="vi">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MỘT SỐ HƯỞNG DẪN VỀ ZEPHYR PROJECT - ZEPHYR OS &mdash; Tài liệu Tutorial Zephyr in UBUNTU ver 1.0.1</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Tìm Kiếm" href="search.html" />
    <link rel="next" title="LVGL" href="lvgl.html" />
    <link rel="prev" title="Contents" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Tutorial Zephyr in UBUNTU
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">MỘT SỐ HƯỞNG DẪN VỀ ZEPHYR PROJECT - ZEPHYR OS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#yeu-cau-ve-phan-cung">Yêu cầu về phần cứng</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cac-buoc-cai-dat">Các bước cài đặt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#buoc-1-cai-dat-cac-tool-phu-thuoc-cmake-python-devicetree-compiler">Bước 1: Cài đặt các tool phụ thuộc (CMake, Python, Devicetree compiler)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buoc-2-cai-moi-truong-ao-va-zephyr-project">Bước 2: Cài môi trường ảo và zephyr project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buoc-3-cai-zephyr-sdk">Bước 3: Cài Zephyr SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buoc-4-build-mot-project-sample">Bước 4: Build một project sample</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cau-truc-ve-zephyr-project">Cấu trúc về Zephyr Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#guiconfig">Guiconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debug-cho-arm-stm32-su-dung-openocd-vscode">Debug cho ARM [STM32]sử dụng OpenOCD + VSCODE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#buoc-1-cai-dat-openocd">Bước 1: Cài đặt openocd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buoc-2-cai-dat-cac-extension-trong-vscode">Bước 2: Cài đặt các extension trong vscode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buoc-3-them-cac-file-json-de-debug-duoc-tren-vscode">Bước 3: Thêm các file json để debug được trên vscode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buoc-4-debug">Bước 4: Debug</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lvgl.html">LVGL</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Tutorial Zephyr in UBUNTU</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">MỘT SỐ HƯỞNG DẪN VỀ ZEPHYR PROJECT - ZEPHYR OS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial_zephyr_install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mot-so-huong-dan-ve-zephyr-project-zephyr-os">
<h1>MỘT SỐ HƯỞNG DẪN VỀ ZEPHYR PROJECT - ZEPHYR OS<a class="headerlink" href="#mot-so-huong-dan-ve-zephyr-project-zephyr-os" title="Permalink to this heading"></a></h1>
<section id="yeu-cau-ve-phan-cung">
<h2>Yêu cầu về phần cứng<a class="headerlink" href="#yeu-cau-ve-phan-cung" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Ubuntu version từ 20 trở lên (khuyến nghị cài dual boot nếu sài máy áo có thể bị lỗi khi flash vào chip).</p></li>
<li><p>Ổ cứng cấp phát cho ubuntu trên 20GB.</p></li>
</ul>
</section>
<section id="cac-buoc-cai-dat">
<h2>Các bước cài đặt<a class="headerlink" href="#cac-buoc-cai-dat" title="Permalink to this heading"></a></h2>
<p><strong>Lưu ý trước khi cài đặt là đảm bảo mạng kết nối luôn ổn định và máy tính không được mất điện giữa lúc cài
(đây là ubuntu nên cái gì cũng có thể đi luôn cái ubuntu)</strong></p>
<section id="buoc-1-cai-dat-cac-tool-phu-thuoc-cmake-python-devicetree-compiler">
<h3>Bước 1: Cài đặt các tool phụ thuộc (CMake, Python, Devicetree compiler)<a class="headerlink" href="#buoc-1-cai-dat-cac-tool-phu-thuoc-cmake-python-devicetree-compiler" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Sử dụng <code class="docutils literal notranslate"><span class="pre">apt</span></code> để cài đặt các tool:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install --no-install-recommends git cmake ninja-build gperf \</span>
<span class="go">ccache dfu-util device-tree-compiler wget \</span>
<span class="go">python3-dev python3-pip python3-setuptools python3-tk python3-wheel xz-utils file \</span>
<span class="go">make gcc gcc-multilib g++-multilib libsdl2-dev libmagic1</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Check lại xem đã cài được chưa:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cmake --version</span>
<span class="go">python3 --version</span>
<span class="go">dtc --version</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Kết quả:</strong></p></li>
</ul>
<img alt="alternate text" src="_images/img_1.png" />
</section>
<section id="buoc-2-cai-moi-truong-ao-va-zephyr-project">
<h3>Bước 2: Cài môi trường ảo và zephyr project<a class="headerlink" href="#buoc-2-cai-moi-truong-ao-va-zephyr-project" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Sử dụng <code class="docutils literal notranslate"><span class="pre">apt</span></code> để cài gói <code class="docutils literal notranslate"><span class="pre">venv</span></code> của Python:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install python3-venv</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Tạo môi trường ảo:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python3 -m venv ~/zephyrproject/.venv</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Activate môi trường ảo:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source ~/zephyrproject/.venv/bin/activate</span>
</pre></div>
</div>
<p><strong>Lưu ý: mỗi khi muốn build hoặc flash zephyr project đều phải sử dụng lệnh này.</strong></p>
<ul class="simple">
<li><p>Cài đặt <code class="docutils literal notranslate"><span class="pre">west</span></code>:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install west</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Get source code của Zephyr:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west init ~/zephyrproject</span>
<span class="go">cd ~/zephyrproject</span>
<span class="go">west update</span>
</pre></div>
</div>
<p><strong>Lưu ý: đây là nguồn để học về các hàm sử dụng trong zephyr rất hiệu quả nên hãy cố gắng khai thác hết mức có thể.</strong></p>
<ul class="simple">
<li><p>Export Zephyr CMake package:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west zephyr-export</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Cài đặt các requirement:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install -r ~/zephyrproject/zephyr/scripts/requirements.txt</span>
</pre></div>
</div>
</section>
<section id="buoc-3-cai-zephyr-sdk">
<h3>Bước 3: Cài Zephyr SDK<a class="headerlink" href="#buoc-3-cai-zephyr-sdk" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Tải và verify Zephyr SDK:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">wget https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.4/zephyr-sdk-0.16.4_linux-x86_64.tar.xz</span>
<span class="go">wget -O - https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.4/sha256.sum | shasum --check --ignore-missing</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Giải nén tệp vừa tải:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tar xvf zephyr-sdk-0.16.4_linux-x86_64.tar.xz</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Cài đặt Zephyr SDK:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd zephyr-sdk-0.16.4</span>
<span class="go">./setup.sh</span>
</pre></div>
</div>
</section>
<section id="buoc-4-build-mot-project-sample">
<h3>Bước 4: Build một project sample<a class="headerlink" href="#buoc-4-build-mot-project-sample" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Chọn một project sample:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">cd ./zephyrproject/zephyr/samples/basic/blinky</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Chọn Board để build:</p></li>
</ul>
<p><strong>Các board mà zephyr hổ trở:</strong> <a class="reference external" href="https://docs.zephyrproject.org/latest/boards/index.html#boards">Supported Boards</a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -p always -b &lt;your-board-name&gt;</span>
</pre></div>
</div>
<p><strong>Nếu bạn thêm lệnh</strong> <code class="docutils literal notranslate"><span class="pre">set(BOARD</span> <span class="pre">&lt;your-board-name&gt;)</span></code> <strong>trong file CMakeLists.txt trong project thì chỉ cần ghi:</strong> <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">build</span></code></p>
<img alt="alternate text" src="_images/img_2.png" />
<p><strong>Nếu như bạn gặp lỗi:</strong></p>
<img alt="alternate text" src="_images/img_3.png" />
<p><strong>Hãy truy cập vào thư mục đó rồi chỉnh sửa file main.c như sau:</strong> <em>(Lưu ý sau khi thay đổi file main.c
hãy xóa thư mục build trong project đó hãy build lại)</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>include &lt;stdio.h&gt;
<span class="gp">#</span>include &lt;zephyr/kernel.h&gt;
<span class="gp">#</span>include &lt;zephyr/drivers/gpio.h&gt;

<span class="go">/* 1000 msec = 1 sec */</span>
<span class="gp">#</span>define SLEEP_TIME_MS   <span class="m">1000</span>

<span class="go">/* The devicetree node identifier for the &quot;led0&quot; alias. */</span>
<span class="gp">#</span>define LED0_NODE DT_ALIAS<span class="o">(</span>led0<span class="o">)</span>
<span class="go">static const struct gpio_dt_spec led = GPIO_DT_SPEC_GET(LED0_NODE, gpios);</span>

<span class="go">int main(void)</span>
<span class="go">{</span>
<span class="go">    int ret;</span>
<span class="go">    bool led_state = true;</span>

<span class="go">    if (!gpio_is_ready_dt(&amp;led)) {</span>
<span class="go">        return 0;</span>
<span class="go">    }</span>

<span class="go">    ret = gpio_pin_configure_dt(&amp;led, GPIO_OUTPUT_ACTIVE);</span>
<span class="go">    if (ret &lt; 0) {</span>
<span class="go">        return 0;</span>
<span class="go">    }</span>

<span class="go">    while (1) {</span>
<span class="go">        ret = gpio_pin_toggle_dt(&amp;led);</span>
<span class="go">        if (ret &lt; 0) {</span>
<span class="go">            return 0;</span>
<span class="go">        }</span>

<span class="go">        led_state = !led_state;</span>
<span class="go">        printf(&quot;LED state: %s\n&quot;, led_state ? &quot;ON&quot; : &quot;OFF&quot;);</span>
<span class="go">        k_msleep(SLEEP_TIME_MS);</span>
<span class="go">    }</span>
<span class="go">    return 0;</span>
<span class="go">}</span>
</pre></div>
</div>
<img alt="alternate text" src="_images/img_4.png" />
</section>
</section>
<section id="cau-truc-ve-zephyr-project">
<h2>Cấu trúc về Zephyr Project<a class="headerlink" href="#cau-truc-ve-zephyr-project" title="Permalink to this heading"></a></h2>
<p><strong>Về phần này các bạn coi theo</strong> <a class="reference external" href="https://docs.google.com/presentation/d/12dFrL5vy-qN5w3uh-lv_V1EL9MIDEYXP/edit#slide=id.g2b313a0e26e_0_132">Slides</a> <strong>của mình làm.</strong></p>
</section>
<section id="guiconfig">
<h2>Guiconfig<a class="headerlink" href="#guiconfig" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Thay vì bạn sử dụng file <cite>pri.conf</cite> để config các ngoại vi, chức năng trên zephyr thì bạn có thể dùng gui.</p></li>
<li><p>Sử dụng lệnh:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -t guiconfig</span>
</pre></div>
</div>
<img alt="alternate text" src="_images/img_5.png" />
</section>
<section id="debug-cho-arm-stm32-su-dung-openocd-vscode">
<h2>Debug cho ARM [STM32]sử dụng OpenOCD + VSCODE<a class="headerlink" href="#debug-cho-arm-stm32-su-dung-openocd-vscode" title="Permalink to this heading"></a></h2>
<section id="buoc-1-cai-dat-openocd">
<h3>Bước 1: Cài đặt openocd<a class="headerlink" href="#buoc-1-cai-dat-openocd" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Đầu tiên hãy kiểm tra xem máy tính đã có openOCD hay chưa: mở termial và gõ lệnh sau:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">openocd</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Nếu màn hình terminal như sau thì máy bạn đã có (bỏ qua bước cài đặt):</p></li>
</ul>
<img alt="alternate text" src="_images/img_6.png" />
<ul class="simple">
<li><p>Nếu không xuất hiện màn hình như trên thì cài openOCD:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt update</span>
<span class="go">sudo apt upgrade</span>
<span class="go">git clone https://github.com/openocd-org/openocd.git</span>
<span class="go">cd openocd</span>
<span class="go">./bootstrap</span>
<span class="go">./configure -–prefix=/usr/local –enable-ftdi –enable-stlink</span>
<span class="go">make</span>
<span class="go">sudo make install</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Tìm đường dẫn đến openocde lưu trong máy:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">which openocd</span>
</pre></div>
</div>
<p><strong>Tham khảo cách cài đặt:</strong> <a class="reference external" href="https://www.youtube.com/watch?v=FNDp1G0bYoU">OPENOCD</a>.</p>
</section>
<section id="buoc-2-cai-dat-cac-extension-trong-vscode">
<h3>Bước 2: Cài đặt các extension trong vscode<a class="headerlink" href="#buoc-2-cai-dat-cac-extension-trong-vscode" title="Permalink to this heading"></a></h3>
<img alt="alternate text" src="_images/img_7.png" />
<img alt="alternate text" src="_images/img_8.png" />
<img alt="alternate text" src="_images/img_9.png" />
</section>
<section id="buoc-3-them-cac-file-json-de-debug-duoc-tren-vscode">
<h3>Bước 3: Thêm các file json để debug được trên vscode<a class="headerlink" href="#buoc-3-them-cac-file-json-de-debug-duoc-tren-vscode" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Thêm một thư mục .vscode gồm có hai file setting.json và launch.json</p></li>
<li><p><em>Lưu ý đổi thành đúng tên user mà máy tính các bạn đã cài đặt trên máy.</em></p></li>
</ul>
<p><strong>Nội dung file setting.json</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{</span>
<span class="go">    &quot;terminal.integrated.env.windows&quot;:</span>
<span class="go">    {</span>
<span class="go">        &quot;PATH&quot;: &quot;/home/dongkhoa/zephyrproject/zephyr/scripts;${env:PATH}&quot;,</span>
<span class="go">        &quot;ZEPHYR_BASE&quot;: &quot;/home/dongkhoa/zephyrprojec/zephyr&quot;</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
<p><strong>Nội dung file launch.json</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{</span>
<span class="go">    &quot;version&quot;: &quot;0.2.0&quot;,</span>
<span class="go">    &quot;configurations&quot;:</span>
<span class="go">    [</span>
<span class="go">        {</span>
<span class="go">            &quot;name&quot;: &quot;STM32Debug&quot;,</span>
<span class="go">            &quot;device&quot;: &quot;STM32F746G_Disco&quot;,</span>
<span class="go">            &quot;gdbPath&quot;: &quot;/home/dongkhoa/zephyr-sdk-0.16.4/arm-zephyr-eabi/bin/arm-zephyr-eabi-gdb&quot;,</span>
<span class="go">            &quot;cwd&quot;: &quot;${workspaceFolder}&quot;,</span>
<span class="go">            &quot;executable&quot;: &quot;${workspaceFolder}/build/zephyr/zephyr.elf&quot;,</span>
<span class="go">            &quot;request&quot;: &quot;launch&quot;,</span>
<span class="go">            &quot;type&quot;: &quot;cortex-debug&quot;,</span>
<span class="go">            &quot;servertype&quot;: &quot;openocd&quot;,</span>
<span class="go">            &quot;interface&quot;: &quot;swd&quot;,</span>
<span class="go">            &quot;configFiles&quot;:[&quot;/home/dongkhoa/zephyrproject/zephyr/boards/arm/stm32f746g_disco/support/openocd.cfg&quot;],</span>
<span class="go">            &quot;runToEntryPoint&quot;: &quot;main&quot;,</span>
<span class="go">            &quot;postRestartCommands&quot;: [</span>
<span class="go">                &quot;break main&quot;,</span>
<span class="go">                &quot;continune&quot;</span>
<span class="go">            ]</span>
<span class="go">        }</span>
<span class="go">    ]</span>
<span class="go">}</span>
</pre></div>
</div>
</section>
<section id="buoc-4-debug">
<h3>Bước 4: Debug<a class="headerlink" href="#buoc-4-debug" title="Permalink to this heading"></a></h3>
<p><strong>Chọn vào nút màu xanh để bắt đầu debug</strong></p>
<img alt="alternate text" src="_images/img_10.png" />
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Contents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lvgl.html" class="btn btn-neutral float-right" title="LVGL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, DONGKHOA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>